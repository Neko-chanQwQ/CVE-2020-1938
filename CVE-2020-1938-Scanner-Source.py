# -*- coding: utf-8 -*-
import re
import nmap
import sys
import time


def address():
    i = 0
    ips = []
    print('''----------------------------Input "quit" to confirm all ip input----------------------------''')
    while True:
        ip = input("Input the number " + str(i+1) + " IP:")
        if ip == "quit":
            break
        #print(ip)
        ips.append(ip)
        #print(ips)
        i = i + 1
    return ips


def version(url):
    nm = nmap.PortScanner()
    nm.scan(url, '8080')
    version = nm[url]['tcp'][8080]['version']
    #print(version)
    num = re.findall(r"\d+", version)
    #print(num)
    return num


def port(host):
    nm = nmap.PortScanner()
    nm.scan(host, '8009')
    status = nm[host]['tcp'][8009]['state']
    #print(status)
    return status


def check1(val1):   #判断tomcat版本
    #print(val1)
    if val1[0] == "6":    #tomcat6
        return True
    if val1[0] == "7":    #tomcat7
        if "0" <= val1[2] <= "100":
            return True
    if val1[0] == "8":    #tomcat8
        if "0" <= val1[1] <= "4":
            return True
        if val1[1] == "5" and "0" <= val1[2] <= "51":
            return True
    if val1[0] == "9":    #tomcat9
        if val1[1] == "0" and "0" <= val1[2] <= "31":
            return True


def check2(ip, val1, val2):
    host = str(ip)
    if val1 == "True" and val2 == "open":
        print(host + " Vulnerable is exist!")
    elif val1 == "True" and val2 == "closed":
        print(host + " Port is down,not vulnerable!")
    else:
        print(host + " Vulnerable is not exist!")


if __name__ == "__main__":
    ip = address()
    for ips in ip:
        #print(ips)
        ver = version(ips)
        status = port(ips)
        result = check1(ver)
        if result == True:
            result2 = "True"
        else:
            result2 = "False"
        #print(result2)
        check2(ips, result2, status)
    time.sleep(3)
    sys.exit(0)
